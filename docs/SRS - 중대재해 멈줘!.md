# SRS - 중대재해 멈줘!

## 1. 문서 개요

### 1.1 목적

이 문서는 **중대재해 멈춰!** 안전관리 웹/앱 서비스의

**시스템 요구사항(SRS, System Requirements Specification)** 을 정의합니다.

- 대상 기능:
    - 사다리 / 고소작업대 / 밀폐공간 **위험작업 체크리스트**
    - 체크리스트 제출 및 **감독자 → 안전관리자** 검토/조치 워크플로우
    - **AI 작업사진 위험분석**
    - 조치 결과 **텍스트 + 사진 기록**

### 1.2 범위

- 플랫폼: Web 기반 (모바일 브라우저 + PC 브라우저)
- 사용자: 기술인, 관리감독자, 안전관리자
- 1차 릴리즈(MVP)는 **삼성/진성이엔지 내부 사용**을 전제로 함
- 법정 자율점검표(사다리·고소작업대·밀폐공간)를 기반으로 한 체크 기능 제공

### 1.3 용어 정의

- **작업유형**: 사다리, 고소작업대, 밀폐공간
- **체크리스트 템플릿**: 법정 양식을 기반으로 사전에 등록된 항목 묶음
- **체크리스트 인스턴스**: 특정 작업에 대해 실제로 작성된 1회분 기록
- **조치 기록**: 감독자/안전관리자가 남기는 텍스트 + 사진 기반 시정조치 내역
- **AI 분석 결과**: 사진에 대한 위험도 진단(안전/주의/위험 + 태그)

---

## 2. 시스템 개요

### 2.1 사용자 역할 및 권한

| 역할 | 주요 권한 | 제한 사항 |
| --- | --- | --- |
| 기술인 | 체크리스트 작성/제출, 사진 업로드, 본인 이력 조회 | 타 사용자 기록 수정/삭제 불가 |
| 관리감독자 | 체크리스트 검토/승인/반려, 조치 요청 댓글 작성, 일부 조치 기록 작성 | 시스템 설정, 템플릿 수정 불가 |
| 안전관리자 | 전체 현장 기록 조회, 조치 기록 작성, 조치 완료 처리, 위험현황 모니터링 | 사용자 계정 관리(최소 권한 원칙 적용) |

---

### 2.2 주요 사용 시나리오 (요약)

1. **기술인**이 사다리 작업 전, 모바일로 “사다리 체크리스트”를 열고 항목을 체크한 뒤 사진을 첨부하여 제출.
2. **관리감독자**가 제출된 체크리스트를 검토하고, 위험 항목(‘아니요’)이 있을 경우 반려 또는 조치 요청.
3. **안전관리자**는 위험도가 높은 건을 우선 조회하고, 필요 시 현장에 이동하여 **조치 후 텍스트 + 사진으로 기록**.
4. 작업사진은 AI 분석 기능으로 자동 위험도(안전/주의/위험)를 판정받고, 체크리스트와 연동.

---

## 3. 기능 요구사항 (Functional Requirements)

각 기능은 **입력(Input) – 처리(Process) – 출력(Output)** 과

**성공/실패 기준**을 포함하여 정의합니다.

---

### 3.1 F-01 사용자 인증 및 권한 관리

**목적**: 사용자별 권한에 따라 화면과 기능 접근을 제한.

- **Actor**: 기술인, 관리감독자, 안전관리자
- **사전조건**: 시스템에 사용자 계정/역할이 등록되어 있음

### 요구사항

1. 시스템은 사용자가 아이디/비밀번호로 로그인할 수 있어야 한다.
2. 시스템은 로그인 시 역할(Role)에 따라 접근 가능한 메뉴를 다르게 제공해야 한다.
3. 로그인 실패 5회 이상 시 5분간 로그인을 제한해야 한다.
4. 사용자는 언제든지 로그아웃할 수 있어야 한다.

---

### 3.2 F-02 작업유형 선택 및 체크리스트 템플릿 로딩

**목적**: 사다리 / 고소작업대 / 밀폐공간 작업에 맞는 체크리스트를 자동으로 제공.

- **Actor**: 기술인

### 입력

- 작업유형(work_type): {사다리, 고소작업대, 밀폐공간}
- 작업일자, 현장명, 공정명(선택), 협력사명(선택)

### 처리

1. 선택된 **작업유형**에 따라 해당 템플릿을 DB에서 조회
    - 사다리: 자율점검표 2-1-3 항목 일괄 매핑
    - 고소작업대: 2-2-2 항목
    - 밀폐공간: 2-3-5 항목
2. 템플릿 항목 리스트를 화면에 표시

### 출력

- 체크 항목 리스트(질문, Yes/No 버튼, 비고 입력란)

### 성능

- 템플릿 로딩 시간: **1초 이내**

---

### 3.3 F-03 체크리스트 작성 및 제출

**목적**: 작업 전 자가진단 내용을 전산화하고 검토 가능한 형태로 저장.

- **Actor**: 기술인

### 입력

- 각 항목에 대한 응답: {네, 아니요}
- 비고(선택 텍스트)
- 작업사진(0~N장, 항목 전체에 공통 또는 특정 항목에 연결 가능)

### 처리

1. 모든 **필수 항목(required = true)** 에 대한 응답을 확인
2. 하나 이상 응답이 ‘아니요’인 항목의 `risk_flag`를 true로 설정
3. 사진 업로드 시 파일 형식(JPG/PNG) 및 용량(10MB 이하) 검증
4. “임시저장” 선택 시 상태 = `draft`, “제출” 선택 시 상태 = `submitted`

### 출력

- 성공 시: “체크리스트가 제출되었습니다.” 메시지
- 실패 시: 누락 항목 및 오류 항목 안내

### 성능 기준

- 임시저장/제출 요청 후 서버 응답: **3초 이내**
- 클라이언트 유효성 검사 오류는 0.5초 이내 표시

---

### 3.4 F-04 감독자 검토 및 승인/반려

**목적**: 작업자가 제출한 체크리스트를 검토하고 승인 또는 재요청.

- **Actor**: 관리감독자

### 입력

- 검토 대상 체크리스트 ID
- 승인 여부: {승인, 반려}
- 반려 사유 텍스트(반려 시 필수)

### 처리

1. 상태가 `submitted` 인 체크리스트만 검토 가능
2. ‘아니요’ 응답이 있는 항목은 상단 Summary에 우선 표시
3. 관리감독자 선택에 따라
    - 승인 시: 상태 = `approved_supervisor`
    - 반려 시: 상태 = `rejected_supervisor` + 반려사유 저장
4. 승인/반려 시 기술인에게 알림 생성

### 출력

- 감독자 화면: 승인/반려 결과 및 타임스탬프
- 기술인 화면: 승인/반려 결과 및 반려사유(반려 시)

### 성능

- 체크리스트 상세 로딩: 2초 이내
- 승인/반려 처리: 3초 이내

---

### 3.5 F-05 안전관리자 위험현황 조회 및 조치 기록

**목적**: 위험도가 높은 작업을 우선 모니터링하고, 조치 내용을 텍스트 + 사진으로 기록.

- **Actor**: 안전관리자 (부분적으로 감독자도 조치 기록 가능 옵션)

### 입력

- 필터 조건: 날짜/현장/작업유형/위험도(‘아니요’ 속성 포함 여부, AI 위험도)
- 선택된 체크리스트 ID
- 조치 내용 텍스트
- 조치 사진(0~N장, 각 10MB 이하)

### 처리

1. ‘아니요’가 하나 이상인 체크리스트를 기본 상위에 표시
2. AI 분석 결과가 “위험”인 사진이 포함된 건은 추가로 상위 노출
3. 안전관리자가 조치 내용을 입력하고 사진을 업로드하면,
    - `action_record` 엔티티에 저장
    - 체크리스트의 `action_status`를 `in_progress` 또는 `completed`로 변경
4. 조치 완료 설정 시, 완료일자, 담당자 정보 기록

### 출력

- 조치 이력 타임라인(텍스트 + 사진)
- 조치 상태(미조치 / 진행중 / 완료)

### 성능 기준

- 위험현황 리스트 로딩: 3초 이내
- 조치 내용 저장: 3초 이내

---

### 3.6 F-06 AI 작업사진 위험분석

**목적**: 업로드된 작업사진에 대해 자동으로 위험도를 판정하고 체크리스트와 연동.

- **Actor**: 기술인(사진 업로드), 시스템/AI 모듈

### 입력

- 작업사진 파일(JPG/PNG, 10MB 이하)
- 선택적 메타 정보(작업유형, 작업명)

### 처리

1. 사진 업로드 완료 후 AI 분석 API 호출
2. AI 분석 결과:
    - 위험도: {안전, 주의, 위험}
    - 태그 예: {“보호구 미착용”, “사다리 미고정”, “난간 없음”, …}
3. 분석 결과를 해당 체크리스트 인스턴스 및 사진과 연결 저장
4. 위험도 = “위험”인 경우 `risk_flag_ai` true 설정

### 출력

- 기술인/감독자/안전관리자 화면에서 사진 옆에 위험도 배지 표시
- 위험 태그 목록 표시

### 성능 기준

- 사진 1장당 분석 시간: **5초 이내**
- 실패 시: “AI 분석 실패, 수동 검토 필요” 메시지 및 로그 남김

---

### 3.7 F-07 알림 기능 (기본 버전)

**목적**: 체크리스트 승인·반려·조치 필요 상황을 사용자에게 전달.

- **Actor**: 시스템

### 케이스

1. 기술인 체크리스트 제출 → 감독자에게 “검토 요청” 알림
2. 감독자 승인/반려 → 기술인에게 “승인/반려 결과” 알림
3. 위험도 높은 건(예: AI=위험, ‘아니요’ 다수) → 안전관리자에게 알림

(알림 UI는 웹 인앱 알림 + 추후 푸시/메일은 2차 범위)

---

## 4. 데이터 요구사항 (고수준 데이터 모델)

### 4.1 핵심 엔티티

- `User` (id, name, role, 팀/현장 정보 등)
- `WorkType` (id, name: 사다리/고소작업대/밀폐공간)
- `ChecklistTemplate` (id, work_type_id, title)
- `ChecklistItemTemplate` (id, template_id, item_code, text, required, order)
    - item_code 예: “2-1-3-1, 2-2-2-1, 2-3-5-1 …”
- `ChecklistInstance` (id, template_id, work_date, site, status, created_by, approved_by, etc.)
- `ChecklistItemResponse` (id, instance_id, item_template_id, answer(yes/no), comment, risk_flag)
- `Photo` (id, instance_id, url/path, uploaded_by, created_at)
- `AIAnalysisResult` (id, photo_id, risk_level, tags, analyzed_at)
- `ActionRecord` (id, instance_id, created_by, text, created_at)
- `ActionPhoto` (id, action_record_id, url/path)

---

## 5. 외부/내부 인터페이스 요구사항

- **웹 클라이언트**: Chrome 기준 최적화, 모바일/PC 모두 지원
- **AI 분석 모듈**: REST API 형태 (예: `POST /api/ai/analyze-photo`)
    - 요청: 사진 파일 + 작업유형
    - 응답: 위험도, 태그
- **인증 서버**: 사내 SSO 연동 여부는 2차 범위, 1차는 자체 계정 기반

---

## 6. 비기능 요구사항 (NFR)

### 6.1 성능

- 동시 사용자 50명 기준으로 정상 동작
- 체크리스트 조회/저장 관련 API 평균 응답시간: 1~3초 이내

### 6.2 보안

- 로그인 필요, 역할 기반 접근 제어(RBAC)
- 모든 API는 인증 토큰 필수
- 사진/데이터는 사내 보안 정책에 따른 저장소 사용

### 6.3 가용성 / 로그

- 시스템 장애 시 에러 로그를 남기고 관리자 페이지에서 조회 가능
- 주요 이벤트(로그인, 체크리스트 제출, 승인/반려, 조치 등록)는 감사 로그로 남김

---

## 7. 범위와 제외 사항 (Scope & Out of Scope)

- **이번 릴리즈 포함**
    - 사다리/고소작업대/밀폐공간 체크리스트
    - 감독자 및 안전관리자 워크플로우
    - 텍스트 + 사진 기반 조치 기록
    - 기본 AI 위험도 분석(정확도 80% 수준 목표)
- **이번 릴리즈 제외**
    - 모든 자율점검표(전체 28p)의 전 항목 전산화
    - 고급 통계 대시보드
    - 외부 법정보고 자동 생성
    - 모바일 앱(네이티브) 출시

> “본 SRS에 정의되지 않은 기능은 이번 릴리스 범위에 포함되지 않는다”
>